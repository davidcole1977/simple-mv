'use strict';function unsubscribe(subscription){subscription.unsubscribe()}var sh=require('./simple-helpers'),_=require('lodash'),appSubsList=require('./app-subscriptions');module.exports={getTopicName:function(options){var topic;return'undefined'==typeof options.target&&(options.target=this),topic=options.eventType+':'+options.target.id,'string'==typeof options.keypath&&(topic+=':'+options.keypath),topic},getAllTopicNames:function(options){var publishTopics;return'undefined'==typeof options.target&&(options.target=this),publishTopics=[options.eventType,options.eventType+':'+options.target.id],options.keypath&&publishTopics.push(options.eventType+':'+options.target.id+':'+options.keypath),publishTopics},emitEvent:function(options){this.getAllTopicNames(options).forEach(function(topic){appSubsList.publish(topic,options.publishParams)})},on:function(options,callback){var newSubscription,topic=this.getTopicName(options);'undefined'==typeof this.selfSubscriptions[topic]&&(this.selfSubscriptions[topic]={unNameSpaced:[]}),'string'==typeof options.nameSpace&&'undefined'==typeof this.selfSubscriptions[topic][options.nameSpace]&&(this.selfSubscriptions[topic][options.nameSpace]=[]),newSubscription=appSubsList.createSubscription(topic,callback),'string'==typeof options.nameSpace?this.selfSubscriptions[topic][options.nameSpace].push(newSubscription):this.selfSubscriptions[topic].unNameSpaced.push(newSubscription)},addListener:function(options,callback){var newSubscription,topic=this.getTopicName(options);'undefined'==typeof this.externalSubscriptions[topic]&&(this.externalSubscriptions[topic]={unNameSpaced:[]}),'string'==typeof options.nameSpace&&'undefined'==typeof this.externalSubscriptions[topic][options.nameSpace]&&(this.externalSubscriptions[topic][options.nameSpace]=[]),newSubscription=appSubsList.createSubscription(topic,callback),'string'==typeof options.nameSpace?this.externalSubscriptions[topic][options.nameSpace].push(newSubscription):this.externalSubscriptions[topic].unNameSpaced.push(newSubscription)},off:function(options){var subsArray,topic=this.getTopicName(options);'undefined'==typeof options.nameSpace?(subsArray=this.selfSubscriptions[topic].unNameSpaced,subsArray.forEach(unsubscribe),subsArray.splice(0,subsArray.length)):(this.selfSubscriptions[topic][options.nameSpace],this.selfSubscriptions[topic][options.nameSpace].forEach(unsubscribe),delete this.selfSubscriptions[topic][options.nameSpace])},removeListener:function(options){var subsArray,topic=this.getTopicName(options);'undefined'==typeof options.nameSpace?(subsArray=this.externalSubscriptions[topic].unNameSpaced,subsArray.forEach(unsubscribe),subsArray.splice(0,subsArray.length)):(this.externalSubscriptions[topic][options.nameSpace],this.externalSubscriptions[topic][options.nameSpace].forEach(unsubscribe),delete this.externalSubscriptions[topic][options.nameSpace])}};