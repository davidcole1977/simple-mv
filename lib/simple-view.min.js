'use strict';var sh=require('./simple-helpers'),_=require('lodash'),GLOBAL_CONFIG=require('./global-config'),sce=require('./simple-create-extend'),appSubsList=require('./app-subscriptions'),EVENTS=GLOBAL_CONFIG.EVENTS,prototype,defaultOptions,create,extend;prototype={createEventType:EVENTS.VIEW.CREATE,bind:function(options){var targetData,createTopic,updateTopic,removeTopic,viewDatum='undefined'==typeof options.viewDatum?null:options.viewDatum,targetDatum='undefined'==typeof options.targetDatum?null:options.targetDatum,optionalKeypath=null===targetDatum?'':':'+targetDatum;if(null===targetDatum)targetData=options.target.getRawData();else try{targetData=options.target.get(targetDatum)}catch(error){targetData=null}null!==targetDatum&&null===viewDatum&&(viewDatum=targetDatum),null===viewDatum?this.data=targetData:this.data[viewDatum]=targetData,createTopic=EVENTS.MODEL.DATUM_CREATE+':'+options.target.id+optionalKeypath,updateTopic=EVENTS.MODEL.DATUM_UPDATE+':'+options.target.id+optionalKeypath,removeTopic=EVENTS.MODEL.DATUM_REMOVE+':'+options.target.id+optionalKeypath,appSubsList.createSubscription(createTopic,this.receiveBindEvent.bind(this,targetDatum,viewDatum)),appSubsList.createSubscription(updateTopic,this.receiveBindEvent.bind(this,targetDatum,viewDatum)),appSubsList.createSubscription(removeTopic,this.receiveBindEvent.bind(this,targetDatum,viewDatum))},unbindData:function(){},receiveBindEvent:function(targetDatum,viewDatum,event){var targetData;targetData=event.eventType===EVENTS.MODEL.DATUM_REMOVE?null:null===targetDatum?event.target.getRawData():event.target.get(targetDatum),this.updateBoundViewData(viewDatum,targetData),this.emitViewBindEvent(viewDatum,event.eventType)},unbind:function(){},updateBoundViewData:function(viewDatumKeyPath,targetData){null!==viewDatumKeyPath?this.data[viewDatumKeyPath]=targetData:this.data=targetData},emitViewBindEvent:function(viewDatumKeypath,modelDatumEventType){var bindEventType;switch(modelDatumEventType){case EVENTS.MODEL.DATUM_CREATE:bindEventType=EVENTS.VIEW.BOUND_DATA_CREATE;break;case EVENTS.MODEL.DATUM_UPDATE:bindEventType=EVENTS.VIEW.BOUND_DATA_UPDATE;break;case EVENTS.MODEL.DATUM_REMOVE:bindEventType=EVENTS.VIEW.BOUND_DATA_REMOVE}this.emitViewEvent(viewDatumKeypath,bindEventType)},emitViewEvent:function(keypath,eventType){var publishParams={keypath:keypath,target:this,eventType:eventType};this.emitEvent({eventType:eventType,keypath:keypath,publishParams:publishParams})}},defaultOptions={type:'view',data:{}},create=sce.create.bind(null,prototype,defaultOptions),extend=sce.extend.bind(null,create),module.exports={create:create,extend:extend};