'use strict';function createLookAheadDatum(data,keys,index){return sh.stringContainsOnlyDigits(keys[index+1])?sh.createFilledArray(parseInt(keys[index+1]),null):{}}function setDeep(data,keypath,keys,index,value){var reachedEnd=index===keys.length-1;'undefined'!=typeof data[keys[index]]||reachedEnd||(data[keys[index]]=createLookAheadDatum(data,keys,index)),reachedEnd?data[keys[index]]=_.cloneDeep(value):setDeep(data[keys[index]],keypath,keys,index+1,value)}var sh=require('./simple-helpers'),_=require('lodash'),GLOBAL_CONFIG=require('./global-config'),sce=require('./simple-create-extend'),EVENTS=GLOBAL_CONFIG.EVENTS,prototype,defaultOptions,create,extend;prototype={eventNamespace:'VIEW',getInitialBoundData:function(targetModel,targetDatum){if('*'===targetDatum)return targetModel.getRawData();try{return targetModel.get(targetDatum)}catch(error){return null}},assignBoundData:function(viewKeypath,targetData){var keys;'*'===viewKeypath?this.data=targetData:(keys=viewKeypath.split('.'),setDeep(this.data,viewKeypath,keys,0,targetData))},bindData:function(options){var targetData,viewKeypath='undefined'==typeof options.viewDatum?'*':options.viewDatum,targetDatum='undefined'==typeof options.targetDatum?'*':options.targetDatum;targetData=this.getInitialBoundData(options.target,targetDatum),('*'!==viewKeypath||null!==targetData)&&this.assignBoundData(viewKeypath,targetData),this.assignBinding(options.target,targetDatum,viewKeypath)},assignDataBindListener:function(target,eventType){this.listenTo({target:target,eventType:eventType},this.receiveBindEvent.bind(this))},assignBinding:function(target,targetKeypath,viewKeypath){var eventTypes=[EVENTS.MODEL.DATUM_CREATE,EVENTS.MODEL.DATUM_UPDATE,EVENTS.MODEL.DATUM_REMOVE];'undefined'==typeof this.bindings[target.id]&&(this.bindings[target.id]={},eventTypes.forEach(this.assignDataBindListener.bind(this,target))),this.bindings[target.id][targetKeypath]=viewKeypath},receiveBindEvent:function(event){var self=this,modelKeypaths=Object.keys(this.bindings[event.target.id]);modelKeypaths.forEach(function(modelKeypath){var viewKeypath,modelData,combinedViewKeypath;sh.keypathIsSameOrDescendent(modelKeypath,event.keypath)&&(viewKeypath=self.bindings[event.target.id][modelKeypath],modelData=event.eventType===EVENTS.MODEL.DATUM_REMOVE?null:'*'===modelKeypath?event.target.getRawData():event.target.get(event.keypath),combinedViewKeypath=(viewKeypath+sh.getKeypathDescendentPortion(modelKeypath,event.keypath)).replace(/^\*\./,''),self.assignBoundData(combinedViewKeypath,modelData))})},unbindData:function(){}},defaultOptions={type:'view',data:{},bindings:{}},create=sce.create.bind(null,prototype,defaultOptions),extend=sce.extend.bind(null,create),module.exports={create:create,extend:extend};